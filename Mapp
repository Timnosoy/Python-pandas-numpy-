import plotly.graph_objects as go
import math

# -----------------------------
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)
# -----------------------------
def haversine_m(lat1, lon1, lat2, lon2):
    R = 6371000
    phi1, phi2 = math.radians(lat1), math.radians(lat2)
    dphi = math.radians(lat2 - lat1)
    dlmb = math.radians(lon2 - lon1)
    a = math.sin(dphi/2)**2 + math.cos(phi1)*math.cos(phi2)*math.sin(dlmb/2)**2
    c = 2 * math.asin(math.sqrt(a))
    return R * c

# -----------------------------
# ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
# -----------------------------
hotel = {"name": "Baan Nampetch Hostel for 4 guest ", "lat": 13.76044, "lng": 100.50095}
    
places = [
    {"name": "Siam Paragon", "lat": 13.75513, "lng": 100.4909},
    {"name": "MBK Center", "lat": 13.75107, "lng": 100.501},
    {"name": "Central World", "lat": 13.76162, "lng": 100.4703},
    {"name": "Lumphini Park", "lat": 13.76075, "lng": 100.4984},
    {"name": "Jim Thompson House", "lat": 13.74693, "lng": 100.535},
]

# -----------------------------
# ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (m/s)
# -----------------------------
walking_speed = 5 / 3.6   # 5 km/h
driving_speed = 30 / 3.6  # 30 km/h

# -----------------------------
# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
# -----------------------------
fig = go.Figure()

# ‡∏à‡∏∏‡∏î‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏° (‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á)
fig.add_trace(go.Scattermapbox(
    lat=[hotel["lat"]],
    lon=[hotel["lng"]],
    mode="markers+text",
    text=[hotel["name"]],
    textposition="top center",
    marker=dict(size=14, color="green"),
    name="Baan Nampetch Hostel for 4 guest"
))

print(f"\nüìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ö‡πÜ {hotel['name']}:\n")

# ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ö ‡πÜ
for p in places:
    dist_m = haversine_m(hotel["lat"], hotel["lng"], p["lat"], p["lng"])
    dist_km = dist_m / 1000
    time_walk_min = dist_m / walking_speed / 60
    time_drive_min = dist_m / driving_speed / 60

    # ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô Terminal
    print(f"‚û°Ô∏è  ‡∏à‡∏≤‡∏Å {hotel['name']} ‡πÑ‡∏õ {p['name']}")
    print(f"   - ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: {dist_km:.2f} ‡∏Å‡∏°.")
    print(f"   - ‡πÄ‡∏î‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: {time_walk_min:.1f} ‡∏ô‡∏≤‡∏ó‡∏µ")
    print(f"   - ‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: {time_drive_min:.1f} ‡∏ô‡∏≤‡∏ó‡∏µ\n")

    # ‡∏à‡∏∏‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
    fig.add_trace(go.Scattermapbox(
        lat=[p["lat"]],
        lon=[p["lng"]],
        mode="markers+text",
        text=[p["name"]],
        textposition="top center",
        marker=dict(size=12, color="red"),
        name=p["name"]
    ))

    # ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏à‡∏≤‡∏Å‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡πÑ‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πâ‡∏ô
    fig.add_trace(go.Scattermapbox(
        lat=[hotel["lat"], p["lat"]],
        lon=[hotel["lng"], p["lng"]],
        mode="lines+text",
        line=dict(width=2, color="green"),
        text=[None, f"{dist_km:.2f} km\n {time_walk_min:.1f} min\n {time_drive_min:.1f} min"],
        textposition="middle right",
        name=f"To {p['name']}"
    ))

# -----------------------------
# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
# -----------------------------
fig.update_layout(
    mapbox_style="open-street-map",
    mapbox_zoom=13,
    mapbox_center={"lat": hotel["lat"], "lon": hotel["lng"]},
    height=700,
    title=f"‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ö‡πÜ {hotel['name']}"
)

fig.show()
